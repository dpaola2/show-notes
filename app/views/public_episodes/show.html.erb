<% content_for(:title) { "#{@episode.title} — #{@podcast.title} | Show Notes" } %>

<% content_for(:head) do %>
  <meta property="og:title" content="<%= truncate(@episode.title, length: 80) %>">
  <meta property="og:description" content="<%= @summary ? @summary.sections.first&.dig("content")&.truncate(200) : "Episode summary from #{@podcast.title}" %>">
  <meta property="og:url" content="<%= public_episode_url(@episode) %>">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Show Notes">
  <% if @episode.og_image.attached? %>
    <meta property="og:image" content="<%= @episode.og_image_url %>">
  <% end %>
<% end %>

<div class="max-w-3xl mx-auto px-4 py-8 sm:py-12">
  <%# Episode header %>
  <div class="flex items-start gap-4 mb-6">
    <% if @podcast.artwork_url.present? %>
      <img src="<%= @podcast.artwork_url %>" alt="<%= @podcast.title %>" class="w-16 h-16 sm:w-20 sm:h-20 rounded-lg shadow-sm object-cover flex-shrink-0">
    <% else %>
      <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-lg shadow-sm bg-gray-200 flex items-center justify-center flex-shrink-0">
        <svg class="w-8 h-8 sm:w-10 sm:h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
        </svg>
      </div>
    <% end %>
    <div>
      <h1 class="text-xl sm:text-2xl font-bold text-gray-900"><%= @episode.title %></h1>
      <p class="text-gray-600 mt-1"><%= @podcast.title %></p>
      <% if @episode.published_at %>
        <p class="text-gray-400 text-sm mt-1"><%= @episode.published_at.strftime("%B %-d, %Y") %></p>
      <% end %>
    </div>
  </div>

  <% if @summary.present? %>
    <%# Summary sections %>
    <div class="space-y-4 sm:space-y-6 mb-8">
      <% @summary.sections.each do |section| %>
        <div class="bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="font-semibold text-lg mb-2"><%= section["title"] %></h2>
          <p class="text-gray-700 leading-relaxed"><%= section["content"] %></p>
        </div>
      <% end %>
    </div>

    <%# Quotes %>
    <% if @summary.quotes.any? %>
      <div class="space-y-3 mb-8">
        <h2 class="text-lg font-semibold text-gray-900">Notable Quotes</h2>
        <% @summary.quotes.each do |quote| %>
          <blockquote class="border-l-4 border-blue-500 pl-4 py-3 bg-blue-50 rounded-r">
            <p class="text-gray-800">"<%= quote["text"] %>"</p>
          </blockquote>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8">
      <p class="text-yellow-800">Summary not yet available</p>
      <p class="text-yellow-600 text-sm mt-1">This episode is still being processed. Check back soon.</p>
    </div>
  <% end %>

  <%# Share button %>
  <div class="mb-8">
    <%= render "shared/share_button", episode: @episode %>
  </div>

  <%# CTA %>
  <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 sm:p-8 text-center">
    <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-2">Get AI summaries for your podcasts</h2>
    <p class="text-gray-600 mb-4">Show Notes delivers concise, AI-powered summaries so you can read the key insights in minutes.</p>
    <%= link_to "Get started — it's free", login_path, class: "inline-block px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition" %>
  </div>
</div>
