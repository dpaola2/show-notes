---
pipeline_stage: 4
pipeline_stage_name: test-generation
pipeline_project: "latest-at-top-digest"
pipeline_started_at: "2026-02-19T07:59:07-0500"
pipeline_completed_at: "2026-02-19T08:10:25-0500"
---

# Test Coverage Matrix — Latest-at-Top Digest Layout

> Generated by Pipeline Stage 4 (Test Generation)
> Maps every gameplan acceptance criterion to its test location(s).

## Test Files Created

| File | Type | Description |
|------|------|-------------|
| `spec/models/episode_featured_digest_scope_spec.rb` | Model | Scope changes: summary filter, recency ordering |
| `spec/mailers/featured_digest_mailer_spec.rb` | Mailer | Featured/recent split, subject line, templates, edge cases |

## Coverage Matrix

| Milestone | Criterion ID | Description | Test File | Test Block |
|-----------|-------------|-------------|-----------|------------|
| M1 | FE-006 / RE-005 | `library_ready_since` INNER JOINs on summary, excluding episodes without summaries | `spec/models/episode_featured_digest_scope_spec.rb` | `excludes episodes that have no summary record` |
| M1 | FE-006 / RE-005 | Returns empty when all qualifying episodes lack summaries | `spec/models/episode_featured_digest_scope_spec.rb` | `returns no episodes when all qualifying episodes lack summaries` |
| M1 | FE-001 / RE-002 | Scope orders by `user_episodes.updated_at DESC` (flat recency) | `spec/models/episode_featured_digest_scope_spec.rb` | `returns episodes ordered by recency across different podcasts` |
| M1 | SL-001 | Subject line: `Podcast Name: Episode Title` | `spec/mailers/featured_digest_mailer_spec.rb` | `formats subject as Podcast Name: Episode Title` |
| M1 | SL-002 | Subject appends `(+N more)` when recent episodes exist | `spec/mailers/featured_digest_mailer_spec.rb` | `appends (+2 more) to subject when 2 recent episodes exist` |
| M1 | RE-004 | Single episode subject (no `+N more`) | `spec/mailers/featured_digest_mailer_spec.rb` | `formats subject as Podcast: Title without (+N more) for single episode` |
| M1 | FE-004 | Featured episode: only 1 summary click event (no listen) | `spec/mailers/featured_digest_mailer_spec.rb` | `does not create a listen click event for the featured episode` |
| M1 | FE-006 | NullMail when all qualifying episodes have no summaries | `spec/mailers/featured_digest_mailer_spec.rb` | `returns NullMail when all qualifying episodes have no summaries` |
| M1 | — | Deliver-later fallback: new subject format | `spec/mailers/featured_digest_mailer_spec.rb` | `uses the new subject line format in deliver_later fallback` |
| M1 | — | Deliver-later fallback: full summary rendering | `spec/mailers/featured_digest_mailer_spec.rb` | `renders full summary section headings in deliver_later fallback` |
| M2 | FE-002 | Featured episode displays all summary section headings | `spec/mailers/featured_digest_mailer_spec.rb` | `FE-002: displays all summary section headings for the featured episode` |
| M2 | FE-002 | Featured episode displays full content of all sections | `spec/mailers/featured_digest_mailer_spec.rb` | `FE-002: displays full content of all summary sections` |
| M2 | FE-003 | Featured episode displays quotes as blockquotes | `spec/mailers/featured_digest_mailer_spec.rb` | `FE-003: displays quotes for the featured episode` |
| M2 | FE-004 | Featured episode "Read in app" tracked link | `spec/mailers/featured_digest_mailer_spec.rb` | `FE-004: shows Read in app link for featured episode` |
| M2 | RE-001 | Up to 5 recent episodes below featured in compact format | `spec/mailers/featured_digest_mailer_spec.rb` | `RE-001: shows Latest episodes heading when multiple episodes exist` |
| M2 | RE-003 | Fewer than 5 additional episodes: display however many available | `spec/mailers/featured_digest_mailer_spec.rb` | Implicitly covered — featured episode tests use 2 recent episodes (< 5) |
| M2 | RE-004 | Single episode: featured only, no recent section | `spec/mailers/featured_digest_mailer_spec.rb` | `RE-004: renders full summary with all sections for a single episode` |
| M2 | RE-006 | "That's all for now" sign-off always present | `spec/mailers/featured_digest_mailer_spec.rb` | `RE-006: displays That's all for now sign-off` |
| M2 | — | Header shows displayed count (not total qualifying) | `spec/mailers/featured_digest_mailer_spec.rb` | `shows displayed episode count in header, not total qualifying` |
| M2 | — | >6 episodes: only 6 shown (1 featured + 5 recent) | `spec/mailers/featured_digest_mailer_spec.rb` | `omits episodes beyond the 6th (1 featured + 5 recent)` |
| M2 | TXT-001 | Text template: full summary section headings | `spec/mailers/featured_digest_mailer_spec.rb` | `TXT-001: includes full summary section headings in text template` |
| M2 | TXT-001 | Text template: full summary content | `spec/mailers/featured_digest_mailer_spec.rb` | `TXT-001: includes full summary content in text template` |
| M2 | TXT-001 | Text template: quotes | `spec/mailers/featured_digest_mailer_spec.rb` | `TXT-001: includes quotes in text template` |
| M2 | TXT-001 | Text template: sign-off | `spec/mailers/featured_digest_mailer_spec.rb` | `TXT-001: includes That's all for now in text template` |
| M2 | TXT-001 | Text template: "Read in app" link | `spec/mailers/featured_digest_mailer_spec.rb` | `TXT-001: includes Read in app in text template` |
| M3 | — | Seed rake task | N/A | Not tested — M3 is a QA support task (seed data), not testable behavior. Level 1 project, minimal scope. |
| M4 | — | Quotes with markdown render as plain text | `spec/mailers/featured_digest_mailer_spec.rb` | `renders quotes as plain text without markdown processing` |
| M4 | — | Empty quotes array: no quotes block | N/A | Cannot produce a failing test — the quotes feature doesn't exist yet, so absence-of-quotes tests pass trivially. Covered by implementation. |
| M4 | — | Long summary content: no truncation | N/A | Cannot produce a failing test — no truncation is the default behavior. Verified by full-content assertion tests above. |
| M4 | — | Footer unchanged | N/A | Not tested — would pass against current codebase (testing existing behavior). Covered by existing specs. |
| M4 | — | All existing mailer specs pass | N/A | Regression check — verified by running full test suite after implementation. |

## Summary

- **Acceptance criteria covered:** 25 of 25 testable criteria across M1-M4
- **Test cases total:** 24 (3 model + 21 mailer)
- **Criteria not directly tested:** 5 (M3 seed task, empty quotes absence, long content no-truncation, footer unchanged, regression)
- **All tests expected to FAIL** — written before implementation (TDD)
