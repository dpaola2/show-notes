---
pipeline_stage: 7
pipeline_stage_name: qa-plan
pipeline_project: "shareable-episode-cards"
pipeline_started_at: "2026-02-18T19:16:24-0500"
pipeline_completed_at: "2026-02-18T19:18:01-0500"
---

# QA Plan — Shareable Episode Cards

> **Generated by:** Pipeline Stage 7 (QA Plan)
> **Date:** 2026-02-18
> **Branch:** `dave/shareable-episode-cards`
> **PR:** TBD
> **Gameplan:** `docs/projects/shareable-episode-cards/gameplan.md`
> **Progress:** `docs/projects/shareable-episode-cards/progress.md`

---

## 1. Feature Summary

This feature adds public, shareable episode summary pages at `/e/:id` with OG meta tags and auto-generated OG images (1200x630, dark card with podcast artwork, title, and quote). Users can share episodes via a share button (Copy Link, Twitter/X, LinkedIn, mobile native share) from both public and authenticated views. UTM parameters track attribution through the signup flow, persisting `referral_source` on new users.

### Milestones Implemented

| Milestone | Description | Commit |
|-----------|-------------|--------|
| M1 | Data Model, Public Page & OG Meta Tags | `e00eeae` |
| M2 | OG Image Generation | `ad0f521` |
| M3 | Share UI, Tracking & UTM Attribution | `25e550d` |
| M4 | QA Test Data | `fd8b82b` |
| M5 | Edge Cases, Empty States & Polish | `87d1d1f` |

---

## 2. Automated Test Coverage

| Metric | Value |
|--------|-------|
| **Total tests** | 578 |
| **Passing** | 578 |
| **Failing** | 0 |
| **Test files (feature)** | 7 |

### Test Types

| Type | File | Count | Covers |
|------|------|-------|--------|
| Model specs | `spec/models/share_event_spec.rb` | 11 | ShareEvent validations, associations, scopes |
| Model specs | `spec/models/episode_shareable_spec.rb` | 5 | Episode share_events, og_image, shareable?, og_image_url |
| Request specs | `spec/requests/public_episodes_spec.rb` | 34 | Public page access, content, OG tags, share endpoint, UTM logging, security |
| Request specs | `spec/requests/sessions_utm_attribution_spec.rb` | 5 | UTM attribution through signup flow |
| Service specs | `spec/services/og_image_generator_spec.rb` | 10 | Image generation, dimensions, artwork handling, text truncation |
| Job specs | `spec/jobs/generate_og_image_job_spec.rb` | 9 | OG image attachment, failure handling, regeneration, ProcessEpisodeJob integration |

### What Automated Tests Verify
- Public page renders without auth, displays correct content, hides management actions and audio URL
- OG meta tags present (og:title, og:description, og:url, og:image when attached)
- OG image generated at 1200x630 with artwork, quote, truncation handling
- Share events created with correct attributes for authenticated and unauthenticated users
- UTM params logged at info level on public page visits
- UTM source persisted as referral_source on new users during signup
- Friendly 404 for missing episodes
- "Summary not yet available" for episodes without summaries
- OG image replaced on regeneration
- Graceful degradation for missing/broken artwork and OG generation failures

---

## 3. Test Data Setup

### Seed Command

```bash
bundle exec rake shareable:seed
```

**Prerequisites:** `libvips` must be installed (required for OG image generation). On macOS: `brew install vips`.

### Scenarios Seeded

| Scenario | User/Login | Data Created | Purpose |
|----------|-----------|--------------|---------|
| Happy path | `share-qa@example.com` (magic link printed in output) | Episode with summary + OG image | Full sharing flow, OG card preview |
| No OG image | same user | Episode with summary, no OG image | Fallback OG tags (text-only) |
| No summary | same user | Episode with no summary | "Summary not yet available" message |
| Long title (100+ chars) | same user | Episode with 150+ char title + summary + OG image | Title truncation in OG image and og:title |
| No quotes | same user | Episode with summary (empty quotes array) + OG image | OG image uses section content fallback |
| Share events | same user | 4 share events (clipboard, twitter, linkedin, native) on Episode 1 | Verify share tracking data |
| Unauthenticated share | N/A | 1 share event with nil user on Episode 2 | Verify anonymous share tracking |
| Referred user | `share-referred@example.com` | User with `referral_source: "share"` | Verify UTM attribution data |

### Post-Seed Verification
- [ ] Seed output prints episode URLs (`/e/:id`) — navigate to each and verify page loads
- [ ] Seed output prints magic link URL — click it to log in as the test user
- [ ] Run `bundle exec rails console` → `ShareEvent.count` returns 5
- [ ] Run `User.find_by(email: "share-referred@example.com").referral_source` returns `"share"`

---

## 4. Manual Testing Checklist

> Covers all acceptance criteria not verified by automated tests. Focus on client-side Stimulus behavior, visual design, and cross-browser OG card rendering.

### 4.1 Share Button UI (SHR-001)

#### QA-001: Share button appears on public episode page
**Criteria:** SHR-001
**Steps:**
1. Run `bundle exec rake shareable:seed`
2. Navigate to `/e/<episode-1-id>` (happy path episode from seed output)
3. Look for a blue "Share" button with a share icon

**Expected:** Share button is visible on the page, styled consistently with the blue primary color (#2563EB), with a share network icon and the text "Share".

---

#### QA-002: Share button appears on authenticated episode view
**Criteria:** SHR-001
**Steps:**
1. Log in using the magic link from the seed output
2. Navigate to an episode detail page via `/episodes/:id`
3. Look for the Share button in the episode header

**Expected:** Share button appears next to the episode title, same styling as the public page share button.

---

#### QA-003: Share button appears on library episode view
**Criteria:** SHR-001
**Steps:**
1. Log in as the test user
2. Navigate to a library episode via `/library/:id`
3. Look for the Share button in the episode header

**Expected:** Share button appears next to the episode title in the library view.

---

### 4.2 Copy Link (SHR-002, TRK-001)

#### QA-004: Copy Link copies URL with UTM params to clipboard
**Criteria:** SHR-002, TRK-001
**Steps:**
1. Navigate to `/e/<episode-1-id>`
2. Click the "Share" button
3. Click "Copy Link" from the popover menu
4. Open a text editor and paste

**Expected:**
- A toast notification appears: "Link copied!"
- Pasted URL is `http://localhost:3000/e/<id>?utm_source=share&utm_medium=social&utm_content=episode_<id>`
- Toast fades after ~2 seconds

---

### 4.3 Twitter/X Share (SHR-003, TRK-001)

#### QA-005: Twitter/X opens pre-filled tweet
**Criteria:** SHR-003, TRK-001
**Steps:**
1. Navigate to `/e/<episode-1-id>`
2. Click "Share" button
3. Click "Twitter / X" from the popover menu

**Expected:**
- A new browser tab opens to `https://twitter.com/intent/tweet?text=...`
- The tweet text contains the episode title and the public URL with UTM params (`utm_source=share&utm_medium=social&utm_content=episode_<id>`)

---

### 4.4 LinkedIn Share (SHR-004, TRK-001)

#### QA-006: LinkedIn opens share dialog
**Criteria:** SHR-004, TRK-001
**Steps:**
1. Navigate to `/e/<episode-1-id>`
2. Click "Share" button
3. Click "LinkedIn" from the popover menu

**Expected:**
- A new browser tab opens to `https://www.linkedin.com/sharing/share-offsite/?url=...`
- The URL parameter contains the public episode URL with UTM params

---

### 4.5 Web Share API (SHR-005)

#### QA-007: Native share on mobile browser
**Criteria:** SHR-005
**Steps:**
1. Open `/e/<episode-1-id>` on a mobile browser (iOS Safari or Android Chrome)
2. If the browser supports Web Share API, look for a "native share" option or the system share sheet

**Expected:**
- On supported browsers: the native OS share sheet appears with the episode title and public URL
- On unsupported browsers: the share button popover still shows Copy Link, Twitter/X, LinkedIn (no native option appears since it's not in the static menu — native share is detected via JS)

**Note:** Web Share API is only available on HTTPS or localhost. Test on a device or use Chrome DevTools mobile emulation with a secure context.

---

### 4.6 Share Event Tracking (TRK-002)

#### QA-008: Share actions create tracking records
**Criteria:** TRK-002
**Steps:**
1. Navigate to `/e/<episode-1-id>`
2. Click Share → Copy Link
3. Open Rails console: `bundle exec rails console`
4. Run: `ShareEvent.last`

**Expected:**
- A ShareEvent record exists with `share_target: "clipboard"`, `episode_id` matching the episode, `user: nil` (unauthenticated), and a `user_agent` string.

---

#### QA-009: Authenticated share associates user
**Criteria:** TRK-002
**Steps:**
1. Log in as the test user via the magic link
2. Navigate to `/library/<user_episode_id>` (a library episode)
3. Click Share → Copy Link
4. Check Rails console: `ShareEvent.last`

**Expected:**
- ShareEvent record has `user_id` matching the logged-in test user.

---

### 4.7 Debounce (Client-Side)

#### QA-010: Rapid share clicks are debounced
**Criteria:** Debounce clicks
**Steps:**
1. Navigate to `/e/<episode-1-id>`
2. Click Share → rapidly click "Copy Link" 5 times in quick succession (within 1 second)
3. Check Rails console: `ShareEvent.where(episode_id: <id>, share_target: "clipboard").count`

**Expected:**
- Only 1 new ShareEvent created (debounce prevents duplicate POSTs within 1 second). Subsequent clicks within the cooldown period are ignored.
- The toast notification may appear multiple times visually but only 1 server-side event is recorded per 1-second window.

---

### 4.8 UTM Attribution Flow (TRK-004)

#### QA-011: UTM source persists through new user signup
**Criteria:** TRK-004
**Steps:**
1. Open a fresh browser or incognito window (no existing session)
2. Navigate to `/e/<episode-1-id>`
3. Click the CTA "Get started — it's free"
4. Verify you land on `/login` — check the URL includes `?utm_source=share` (this is the CTA link)

**Note:** The CTA links to `/login` without UTM params currently. To test the full UTM flow:
1. Manually navigate to `/login?utm_source=share`
2. Enter a new email address (e.g., `qa-test-<timestamp>@example.com`)
3. Check email delivery (Letter Opener in dev: visit `/letter_opener`)
4. Click the magic link to verify
5. Check Rails console: `User.find_by(email: "qa-test-...").referral_source`

**Expected:** The new user's `referral_source` is `"share"`.

---

### 4.9 OG Card Preview

#### QA-012: OG image renders on social platforms
**Criteria:** OGI-001 through OGI-006
**Steps:**
1. Run the seed task and note the Episode 1 URL (`/e/<id>`)
2. If the app is accessible via a public URL (e.g., deployed to staging), test with:
   - [Twitter Card Validator](https://cards-dev.twitter.com/validator)
   - [LinkedIn Post Inspector](https://www.linkedin.com/post-inspector/)
   - [Facebook Sharing Debugger](https://developers.facebook.com/tools/debug/)
3. If testing locally only: inspect the page source and verify:
   - `<meta property="og:title" content="...">` — truncated to 80 chars for long titles
   - `<meta property="og:description" content="...">` — first section content, truncated to 200 chars
   - `<meta property="og:url" content="...">` — full public URL
   - `<meta property="og:image" content="...">` — Active Storage blob URL (for episodes with OG images)

**Expected:** Social platforms render a rich card with the podcast artwork, episode title, and quote excerpt on the dark card image.

---

#### QA-013: Fallback OG tags when no OG image
**Criteria:** OG failure fallback
**Steps:**
1. Navigate to `/e/<episode-2-id>` (summary but no OG image)
2. View page source

**Expected:**
- `og:title`, `og:description`, `og:url` meta tags are present
- No `og:image` meta tag is present
- Social platforms will use a text-only preview (no image card)

---

### 4.10 Visual Design & Responsive Layout

#### QA-014: Public page is mobile-friendly
**Criteria:** Responsive design
**Steps:**
1. Open `/e/<episode-1-id>` on a mobile device or use Chrome DevTools responsive mode (iPhone SE, 375px width)
2. Check:
   - Artwork and title fit within the viewport without horizontal scroll
   - Summary sections are readable
   - Share button is tappable
   - CTA is visible and tappable
   - Footer is visible

**Expected:** Page renders cleanly at mobile widths. Text wraps properly. No horizontal overflow.

---

#### QA-015: Share popover styling
**Criteria:** Share popover styling
**Steps:**
1. Navigate to `/e/<episode-1-id>` on both desktop and mobile viewport
2. Click the Share button
3. Inspect the popover menu

**Expected:**
- Popover appears below the Share button with a white background, rounded corners, shadow border
- Three options visible: Copy Link, Twitter / X, LinkedIn — each with an icon and label
- Hover state highlights the option with gray background
- Menu is readable and not clipped by the viewport edge

---

#### QA-016: Generic podcast icon when no artwork
**Criteria:** No artwork placeholder
**Steps:**
1. In Rails console, find or create a podcast with `artwork_url: nil`
2. Create an episode for that podcast with a summary
3. Navigate to `/e/<that-episode-id>`

**Expected:** A gray rounded square with a microphone icon appears where the artwork would normally be (16x16 on mobile, 20x20 on desktop).

---

---

## 5. Edge Cases & Boundary Conditions

| # | Scenario | How to Test | Expected Result | Criteria |
|---|----------|-------------|-----------------|----------|
| 1 | Episode with no summary | Visit `/e/<episode-3-id>` (seeded) | Yellow banner: "Summary not yet available" with episode title and podcast name visible | No summary |
| 2 | Very long title (100+ chars) | Visit `/e/<episode-4-id>` (seeded) | Title displays in full on page; `og:title` meta tag is truncated with "..." at 80 chars; OG image truncates at 80 chars | Long title |
| 3 | Episode with no quotes | Visit `/e/<episode-5-id>` (seeded) | OG image uses first sentence of first section as the excerpt | No quotes |
| 4 | Non-existent episode | Visit `/e/999999` | Returns HTTP 404 with "Episode not found" text | Deleted episode |
| 5 | Low-res artwork | Set podcast `artwork_url` to a tiny image (<100px), regenerate OG image | OG image scales artwork without error; may appear pixelated but no crash | Low-res artwork |
| 6 | Artwork fetch failure | Set podcast `artwork_url` to a broken URL, run `GenerateOgImageJob.perform_now(episode.id)` | OG image generates without artwork (text-only card) | OGI-007 |
| 7 | Rapid double-click on Share→Copy | Click Copy Link twice quickly | Only 1 ShareEvent created; toast appears at least once | Debounce |
| 8 | Social platform cache | Share episode, regenerate summary + OG image, re-share | Social platforms may show old image due to caching. Use platform-specific cache invalidation tools. | Social cache |

---

## 6. Known Limitations

| Item | Status | Notes |
|------|--------|-------|
| Social platform OG cache | Known limitation | Platforms cache OG images aggressively. After regeneration, use Twitter Card Validator or LinkedIn Post Inspector to force re-fetch. No in-app fix. |
| No backfill rake task | Not implemented | Existing episodes with summaries don't automatically get OG images. New episodes get them via `ProcessEpisodeJob`. A one-time backfill can be run manually via Rails console if needed. |
| Quote-specific OG images (SHR-006) | Deferred | Nice-to-have priority. Not implemented in v1. |
| Analytics dashboard for shares | Deferred | Share events are tracked in the database but no dashboard exists. Query via Rails console. |
| Custom OG image editor | Out of scope | Users cannot customize OG card appearance. |
| Audio on public pages | Out of scope | Public pages intentionally exclude the audio player to preserve the signup incentive. |
| Share popover doesn't close on outside click | Minor UX gap | Popover stays open until the Share button is clicked again. Doesn't close when clicking outside or after selecting an action. |
| CTA link doesn't carry UTM params | Gap | The "Get started" CTA on the public page links to `/login` without UTM params. The UTM attribution flow works when visiting `/login?utm_source=share` directly (e.g., from a shared link), but organic CTA clicks from the public page won't set `referral_source`. |

---

## 7. Regression Concerns

| Area | Risk | What to Check |
|------|------|---------------|
| Login/signup flow | Medium | SessionsController was modified to capture UTM params and persist referral_source. Verify: existing login flow still works (no UTM params), magic link still works, returning users still log in correctly. |
| Test environment logging | Low | `config/environments/test.rb` suppresses framework logging. Verify: tests still pass, no unexpected test behavior from suppressed logs. (Already verified: 578 passing.) |
| Episode model | Low | `episode.rb` gained `has_many :share_events` and `has_one_attached :og_image`. Verify: existing episode features (library, inbox, archive, digest) still work. |
| User model | Low | `user.rb` gained `has_many :share_events, dependent: :nullify`. Verify: user deletion doesn't cascade-delete share events (nullifies instead). |
| ProcessEpisodeJob | Low | Modified to enqueue `GenerateOgImageJob`. Verify: episode processing still works end-to-end (transcribe → summarize → OG image). |
| Existing views | Low | `episodes/show.html.erb` and `library/show.html.erb` gained share button partial. Verify: these pages still render correctly with no layout breakage. |

---

## 8. Rollback Plan

| Step | Action | Notes |
|------|--------|-------|
| Feature flag | No feature flag | Rollback requires reverting the merge commit on `main` |
| Code revert | `git revert <merge-commit>` on `main` | Reverts all code changes. Public URLs will return 404s. |
| Migration | Reversible | `rails db:rollback STEP=3` removes share_events table, referral_source column, and Active Storage tables. **Warning:** This deletes all share event data and any Active Storage attachments (OG images). |
| Data cleanup | Share events and OG images lost on rollback | If rollback is needed after production data exists, consider keeping migrations and only reverting code. Share events and OG images are non-critical — losing them is acceptable. |
| Routes | Auto-reverted with code | `/e/:id` and `/e/:id/share` routes removed on revert. Existing URLs will 404. |

---

## QA Sign-Off

### Tester: ___________
### Date: ___________
### Status: Pending

- [ ] All manual test scenarios verified (QA-001 through QA-016)
- [ ] Edge cases tested (scenarios 1-8)
- [ ] Regression areas checked (login flow, episode processing, existing views)
- [ ] No blocking issues found

#### Issues Found
| # | Severity | Description | Status |
|---|----------|-------------|--------|
| | | | |

#### Notes
[Any observations, feedback, or suggestions from QA]
